<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing one file per chunks vs. one file per blocks - Apache Hadoop Ozone Development notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://elek.github.io/ozone-notes/favicon.png">

  
  
  <link rel="stylesheet" href="/ozone-notes/css/style.min.22519856e60921f42cfae62f3aca24255098741556c2ccb420c817a0adcde3f9.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/ozone-notes/">
        <span>Home</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://elek.github.io/ozone-notes/"><img alt="Logo" src="/ozone-notes/" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://elek.github.io/ozone-notes/"><img alt="Logo" src="/ozone-notes/" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/ozone-notes/">
        <span>Home</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#how-to-test">How to test?</a></li>
    <li><a href="#environment">Environment</a></li>
    <li><a href="#test-results">Test results</a></li>
  </ul>
</nav>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Writing one file per chunks vs. one file per blocks</h1>
<div class="content ">
  <ul>
<li>Docker image: elek/ozone-dev:HDDS-2717-cmdw</li>
</ul>
<h2 id="how-to-test">How to test?</h2>
<ul>
<li>Freon test executed Chunk Writes calling the <code>ChunkManagerImpl.writeChunk</code> method directly.</li>
<li>Size of chunks has been modified between the tests</li>
<li>All the results are</li>
<li>All the tests are executed parallel on 6 machines (one test requires only one machine &ndash;&gt; 6 test results)</li>
<li>After the freon test a <code>sync</code> call has been executed. If it took &gt;0.1s, the sync time has been added to the measured write time.</li>
<li>Real hard disk has been used</li>
</ul>
<p>Example test script:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">ozone freon --verbose cmdw -n10000 -s 102400 -c 16 -t16 -l FILE_PER_BLOCK
date
time sync
date
echo &#34;Hostname: $(hostname)&#34;
echo &#34;TEST HAS BEEN FINISHED&#34;
sleep 100000
</code></pre></div><p>Executed tests:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">execute_test perchunk-1k   ozone freon --verbose cmdw -n1000000 -s 1024    -t16 -l FILE_PER_CHUNK
execute_test perchunk-10k  ozone freon --verbose cmdw -n100000  -s 10240   -t16 -l FILE_PER_CHUNK
execute_test perchunk-100k ozone freon --verbose cmdw -n10000   -s 102400  -t16 -l FILE_PER_CHUNK
execute_test perchunk-1M   ozone freon --verbose cmdw -n1000    -s 1024000 -t16 -l FILE_PER_CHUNK
execute_test perchunk-4M   ozone freon --verbose cmdw -n100     -s 4096000 -t16 -l FILE_PER_CHUNK


execute_test onefile-1k    ozone freon --verbose cmdw -n1000000 -s 1024    -c 16 -t16 -l FILE_PER_BLOCK
execute_test onefile-10k   ozone freon --verbose cmdw -n100000  -s 10240   -c 16 -t16 -l FILE_PER_BLOCK
execute_test onefile-100k  ozone freon --verbose cmdw -n10000   -s 102400  -c 16 -t16 -l FILE_PER_BLOCK
execute_test onefile-1M    ozone freon --verbose cmdw -n1000    -s 1024000 -c 16 -t16 -l FILE_PER_BLOCK
execute_test onefile-4M    ozone freon --verbose cmdw -n100     -s 4096000 -c 16 -t16 -l FILE_PER_BLOCK
</code></pre></div><h2 id="environment">Environment</h2>
<p>Tests are run on a 10 node physical cluster (only 3 nodes were used in a given time)</p>
<ul>
<li>Cisco UCSC-C220-M4L racks</li>
<li>2 x Intel(R) Xeon(R) CPU E5-2630 v3 @ 2.40GHz (2 x 8 core &ndash;&gt; 2 x 16 threads)</li>
<li>256GB mem</li>
<li>HGST HUS726060AL4210 SCSi disks</li>
</ul>
<p><strong>All the tests are executed three times, on 3 different machines parallel</strong></p>
<h2 id="test-results">Test results</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">testname        rate                    chunks  sec             sync
onefile-100k	9718.592507444693	10000	4		0m17.418s
onefile-100k	9722.676047031922	10000	4		0m17.777s
onefile-100k	9719.050682705287	10000	4		0m17.898s
onefile-100k	9758.300509215931	10000	4		0m18.005s
onefile-100k	9762.677767708628	10000	4		0m17.978s
onefile-100k	9734.463205598586	10000	4		0m19.281s

onefile-10k	93419.46017150157	100000	4		0m15.858s
onefile-10k	93696.40662165661	100000	4		0m16.094s
onefile-10k	97504.11938816235	100000	3		0m16.178s
onefile-10k	93755.63005488343	100000	4		0m16.681s
onefile-10k	87472.2507514669	100000	4		0m16.355s
onefile-10k	71124.24526195972	100000	4		0m18.288s
onefile-1k	329674.4873003501	1000000	5		0m16.352s
onefile-1k	395181.4064201807	1000000	5		0m16.332s
onefile-1k	330022.30937940534	1000000	6		0m16.311s
onefile-1k	454726.63665333844	1000000	5		0m16.241s
onefile-1k	329875.5645803382	1000000	6		0m16.032s
onefile-1k	318038.9377145058	1000000	6		0m17.992s
onefile-1M	974.6677307023314	1000	4		0m10.824s
onefile-1M	975.8830033384957	1000	4		0m10.770s
onefile-1M	977.8707019186994	1000	4		0m10.732s
onefile-1M	969.9443443025407	1000	4		0m11.095s
onefile-1M	914.5892375003585	1000	4		0m9.749s
onefile-1M	969.9313878877617	1000	4		0m12.034s
onefile-4M	97.63963343164137	100	4		0m4.067s
onefile-4M	84.23741908523114	100	4		0m4.313s
onefile-4M	97.74440132287272	100	4		0m3.471s
onefile-4M	98.00806708908581	100	4		0m4.568s
onefile-4M	97.9658124002108	100	4		0m4.223s
onefile-4M	97.7080350677499	100	4		0m4.262s
perchunk-100k	9746.162893029552	10000	4		0m16.403s
perchunk-100k	9723.154687611583	10000	4		0m16.049s
perchunk-100k	9750.785190509403	10000	4		0m16.010s
perchunk-100k	8098.507189940932	10000	4		0m15.702s
perchunk-100k	9749.991659613384	10000	3		0m16.194s
perchunk-100k	9742.77946659929	10000	4		0m17.370s
perchunk-10k	65106.33467370175	100000	4		0m19.251s
perchunk-10k	65901.61482021875	100000	4		0m19.971s
perchunk-10k	67843.26480981767	100000	4		0m19.669s
perchunk-10k	64629.24204758634	100000	4		0m19.586s
perchunk-10k	49293.41186885904	100000	5		0m19.413s
perchunk-10k	49136.89315104702	100000	5		0m21.224s
perchunk-1k	124198.8051207543	1000000	11		1m20.980s
perchunk-1k	116521.04902996239	1000000	11		1m22.745s
perchunk-1k	110797.51590364997	1000000	12		1m22.156s
perchunk-1k	117657.46404823025	1000000	11		1m24.717s
perchunk-1k	99719.9752903275	1000000	12		1m12.232s
perchunk-1k	110731.0381296006	1000000	12		1m26.626s
perchunk-1M	976.6990948021158	1000	4		0m15.740s
perchunk-1M	979.5745511221822	1000	3		0m16.113s
perchunk-1M	974.7307401123004	1000	4		0m16.217s
perchunk-1M	972.326921439805	1000	4		0m15.811s
perchunk-1M	968.7241283149776	1000	4		0m15.686s
perchunk-1M	974.4809193020677	1000	4		0m17.188s
perchunk-4M	97.71888370102266	100	4		0m5.790s
perchunk-4M	97.92370085659168	100	4		0m6.224s
perchunk-4M	97.66749854893443	100	4		0m5.753s
perchunk-4M	97.7990869991661	100	4		0m6.442s
perchunk-4M	98.08197096364069	100	4		0m6.305s
perchunk-4M	97.68548276230054	100	4		0m6.512s
</code></pre></div>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/ozone-notes/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
