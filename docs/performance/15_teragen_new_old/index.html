<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Teragen crosscheck of master / HDDS-2717 (new / old layout) - Apache Hadoop Ozone Development notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://elek.github.io/ozone-notes/favicon.png">

  
  
  <link rel="stylesheet" href="/ozone-notes/css/style.min.22519856e60921f42cfae62f3aca24255098741556c2ccb420c817a0adcde3f9.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/ozone-notes/">
        <span>Home</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://elek.github.io/ozone-notes/"><img alt="Logo" src="/ozone-notes/" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://elek.github.io/ozone-notes/"><img alt="Logo" src="/ozone-notes/" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/ozone-notes/">
        <span>Home</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#test-method">Test method</a></li>
    <li><a href="#environment">Environment</a></li>
    <li><a href="#results">Results</a>
      <ul>
        <li><a href="#running-teragen-with-hdfs">Running teragen with HDFS</a></li>
        <li><a href="#running-teragen-with-ozone-master">Running teragen with Ozone master</a></li>
        <li><a href="#running-teragen-with-ozone-master-file_per_block">Running teragen with Ozone master (FILE_PER_BLOCK)</a></li>
        <li><a href="#running-teragen-with-ozone-master-file_per_chunk">Running teragen with Ozone master (FILE_PER_CHUNK)</a></li>
        <li><a href="#running-terage-with-ozone-master-second-run-to-double-check-previous-results">Running terage with Ozone master (second run to double check previous results)</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Teragen crosscheck of master / HDDS-2717 (new / old layout)</h1>
<div class="content ">
  <h1 id="ozone-performance-15-teragen-crosscheck-of-master--hdds-2717-new--old-layout">Ozone Performance #15: Teragen crosscheck of master / HDDS-2717 (new / old layout)</h1>
<h2 id="test-method">Test method</h2>
<ul>
<li>100G Teragen has been executed on Yarn with using o3fs as input / output dir</li>
<li>3 nodes are used for HDFS/Ozone 3 nodes for YARN</li>
<li>Storage
<ul>
<li>Ratis log is saved to memdisk</li>
<li>OM, SCM metadata is saved to disk (emptyDir)</li>
<li>Chunks are saved to real disk (hostPath)</li>
<li>Local disks are deleted after each sequence of tests</li>
</ul>
</li>
<li>Default settings used except:
<ul>
<li><strong>GC</strong>
<ul>
<li>HADOOP_OPTS: -server -XX:ParallelGCThreads=8 -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly</li>
</ul>
</li>
<li><strong>Handlers</strong>:
<ul>
<li>OZONE-SITE.XML_ozone.om.handler.count.key: &ldquo;250&rdquo;</li>
<li>OZONE-SITE.XML_ozone.scm.handler.count.key: &ldquo;250&rdquo;</li>
</ul>
</li>
</ul>
</li>
<li>Provisioned with kubernetes
<ul>
<li>3 nodes are assigned to HDFS <em>and</em> Ozone</li>
<li>3 nodes are assigned to Yarn</li>
<li>Kubernetes master is not used</li>
</ul>
</li>
<li>Result is checked via Yarn Rest API:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">curl http://myhost:32230/ws/v1/cluster/apps | jq -r &#39;.apps.app[] | [.id,.state,.finalStatus,.elapsedTime, .vcoreSeconds] | @csv&#39;
</code></pre></div><p><strong>Test script</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">ROWS=$(numfmt --from=auto --to-unit=100 100G)
OUTPUT_DIR=teragen-$(shuf -i 1000-2000 -n 1)

OUTPUT_DIR=o3fs://bucket1.vol1.ozone-om-0.ozone-om/$OUTPUT_DIR

MR_EXAMPLES_JAR=/opt/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.2.1.jar

time yarn jar $MR_EXAMPLES_JAR teragen \
-Dmapreduce.map.log.level=INFO \
-Dmapreduce.reduce.log.level=INFO \
-Dyarn.app.mapreduce.am.log.level=INFO \
-Dmapreduce.map.cpu.vcores=1 \
-Dmapreduce.map.java.opts=-Xmx1536m \
-Dmapreduce.map.maxattempts=1 \
-Dmapreduce.map.memory.mb=2048 \
-Dmapreduce.map.output.compress=true \
-Dmapreduce.map.output.compress.codec=org.apache.hadoop.io.compress.Lz4Codec \
-Dmapreduce.reduce.cpu.vcores=1 \
-Dmapreduce.reduce.java.opts=-Xmx1536m \
-Dmapreduce.reduce.maxattempts=1 \
-Dmapreduce.reduce.memory.mb=2048 \
-Dyarn.app.mapreduce.am.command.opts=-Xmx768m \
-Dyarn.app.mapreduce.am.resource.mb=1024 \
-Dmapreduce.task.io.sort.factor=100 \
-Dmapreduce.task.io.sort.mb=384 \
-Dmapred.map.tasks=92 \
-Dio.file.buffer.size=131072 \
$ROWS $OUTPUT_DIR

sleep 10000000
</code></pre></div><h2 id="environment">Environment</h2>
<ul>
<li>6 Dell PowerEdge R440</li>
<li>Intel(R) Xeon(R) Silver 4114 CPU @ 2.20GHz</li>
<li>128GB Ram</li>
<li>4-2TB disks</li>
</ul>
<h2 id="results">Results</h2>
<h3 id="running-teragen-with-hdfs">Running teragen with HDFS</h3>
<p>Hadoop version:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">Hadoop 3.2.1
Source code repository https://gitbox.apache.org/repos/asf/hadoop.git -r b3cbbb467e22ea829b3808f4b7b01d07e0bf3842
Compiled by rohithsharmaks on 2019-09-10T15:56Z
Compiled with protoc 2.5.0
From source with checksum 776eaf9eee9c0ffc370bcbc1888737
This command was run using /opt/hadoop/share/hadoop/common/hadoop-common-3.2.1.jar
</code></pre></div><p>From 3 run:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">&#34;application_1583838490219_0001&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,555664,6328
&#34;application_1583838490219_0002&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,563995,6462
&#34;application_1583838490219_0003&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,584901,6694
</code></pre></div><h3 id="running-teragen-with-ozone-master">Running teragen with Ozone master</h3>
<p>Ozone version: <code>elek/ozone-dev:49edf55c8</code></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">&#34;application_1583847724655_0001&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,637877,7283
&#34;application_1583847724655_0002&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,674029,7681
&#34;application_1583847724655_0003&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,736952,8436
</code></pre></div><h3 id="running-teragen-with-ozone-master-file_per_block">Running teragen with Ozone master (FILE_PER_BLOCK)</h3>
<ul>
<li>Ozone version: <code>elek/ozone-dev:290c827ec</code></li>
<li><code>OZONE-SITE.XML_ozone.scm.chunk.layout: FILE_PER_BLOCK</code></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">&#34;application_1583852788449_0003&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,561795,6347
&#34;application_1583852788449_0002&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,533016,6055
&#34;application_1583852788449_0004&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,543886,6155
&#34;application_1583852788449_0001&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,518231,5838
</code></pre></div><h3 id="running-teragen-with-ozone-master-file_per_chunk">Running teragen with Ozone master (FILE_PER_CHUNK)</h3>
<ul>
<li>Ozone version: <code>elek/ozone-dev:290c827ec</code></li>
<li><code>OZONE-SITE.XML_ozone.scm.chunk.layout: FILE_PER_CHUNK</code></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">&#34;application_1583856757708_0003&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,608841,6905
&#34;application_1583856757708_0002&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,586114,6644
&#34;application_1583856757708_0001&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,576812,6496
</code></pre></div><h3 id="running-terage-with-ozone-master-second-run-to-double-check-previous-results">Running terage with Ozone master (second run to double check previous results)</h3>
<p>Ozone version: <code>elek/ozone-dev:49edf55c8</code></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">&#34;application_1583861158263_0002&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,588957,6708
&#34;application_1583861158263_0003&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,634666,7218
&#34;application_1583861158263_0001&#34;,&#34;FINISHED&#34;,&#34;SUCCEEDED&#34;,580441,6569
</code></pre></div>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/ozone-notes/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
