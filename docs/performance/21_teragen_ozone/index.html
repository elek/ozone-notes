<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ozone teragen fixes - Apache Hadoop Ozone Development notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://elek.github.io/ozone-notes/favicon.png">

  
  
  <link rel="stylesheet" href="/ozone-notes/css/style.min.e4a998fd3312b7b4b27be6b707077f6d2989860cbfb9eb31322a49baf63d68b3.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/ozone-notes/">
        <span>Home</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://elek.github.io/ozone-notes/"><img alt="Logo" src="/ozone-notes/" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://elek.github.io/ozone-notes/"><img alt="Logo" src="/ozone-notes/" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/ozone-notes/">
        <span>Home</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#test-definition">Test definition</a></li>
    <li><a href="#results">Results</a></li>
    <li><a href="#detailed-results">Detailed results</a>
      <ul>
        <li><a href="#teragen-10g---base-run">Teragen 10g - base run</a></li>
        <li><a href="#teragen-10g---using-memdisk">Teragen 10g - using memdisk</a></li>
      </ul>
    </li>
    <li><a href="#teragen-10g--memdisk--92-mappers">Teragen 10g + memdisk + 92 mappers</a>
      <ul>
        <li><a href="#memdisk--2-mappers--freon">memdisk + 2 mappers + freon</a></li>
      </ul>
    </li>
    <li><a href="#hardware-physical-machines-gru8">Hardware (physical machines, gru8)</a></li>
  </ul>
</nav>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Ozone teragen fixes</h1>
<div class="content ">
  <h2 id="test-definition">Test definition</h2>
<p>Executing terage with Ozone vs HDFS and default settings. The measurement proves that HDDS-4119 (and RATIS-1042) fixes almost all the performance problems related to limited number of mappers.</p>
<h2 id="results">Results</h2>
<table>
<thead>
<tr>
<th>test</th>
<th>overall time</th>
<th>write time / container</th>
</tr>
</thead>
<tbody>
<tr>
<td>base run</td>
<td>5m56.154s</td>
<td>193322 / 213265</td>
</tr>
<tr>
<td>memdisk</td>
<td>4m16.507s</td>
<td>123432 / 122818</td>
</tr>
<tr>
<td>memdisk + 92 mappers</td>
<td>1m21.629s</td>
<td>~ 4000</td>
</tr>
<tr>
<td>memdisk + 2 mappers + freon</td>
<td>4m11.554s</td>
<td>120016 / &hellip;</td>
</tr>
<tr>
<td>memdisk + 2 mappers + patchfix</td>
<td>1m39.091s</td>
<td>without byteman</td>
</tr>
</tbody>
</table>
<h2 id="detailed-results">Detailed results</h2>
<h3 id="teragen-10g---base-run">Teragen 10g - base run</h3>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">real	5m56.154s
user	0m12.142s
sys	0m0.957s
+ echo &#39;Test is Done&#39;
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">Closing file system instance: 508487439
   write.call: 100001066
   write.allTime: 193322
   hsync.call: 1
   hsync.allTime: 1
   hflush.call: 0
   hflush.allTime: 0
   close.call: 4
   close.allTime: 70
Closing file system instance: 1928802676
   write.call: 100001066
   write.allTime: 213265
   hsync.call: 1
   hsync.allTime: 1
   hflush.call: 0
   hflush.allTime: 0
   close.call: 4
   close.allTime: 90
</code></pre></div><p>Number of chunk write requets (during 10g test):</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">csm_metrics_write_chunk_num_ops = 2395
om_metrics_num_create_file = 14
</code></pre></div><h3 id="teragen-10g---using-memdisk">Teragen 10g - using memdisk</h3>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">real    4m16.507s
user    0m11.623s
sys     0m0.864s
+ echo &#39;Test is Done&#39;
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">Closing file system instance: 1199373551
   write.call: 100001066
   write.allTime: 123432
   hsync.call: 1
   hsync.allTime: 3
   hflush.call: 0
   hflush.allTime: 0
   close.call: 4
   close.allTime: 69
Closing file system instance: 1365750726
   write.call: 100001066
   write.allTime: 122818
   hsync.call: 1
   hsync.allTime: 3
   hflush.call: 0
   hflush.allTime: 0
   close.call: 4
   close.allTime: 59
</code></pre></div><h2 id="teragen-10g--memdisk--92-mappers">Teragen 10g + memdisk + 92 mappers</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">2020-08-11 11:56:58 INFO  Job:1665 - Counters: 34
	File System Counters
		FILE: Number of bytes read=0
		FILE: Number of bytes written=24362510
		FILE: Number of read operations=0
		FILE: Number of large read operations=0
		FILE: Number of write operations=0
		O3FS: Number of bytes read=7893
		O3FS: Number of bytes written=10000000000
		O3FS: Number of read operations=1012
		O3FS: Number of large read operations=0
		O3FS: Number of write operations=184
	Job Counters
		Killed map tasks=1
		Launched map tasks=92
		Other local map tasks=92
		Total time spent by all maps in occupied slots (ms)=1045972
		Total time spent by all reduces in occupied slots (ms)=0
		Total time spent by all map tasks (ms)=1045972
		Total vcore-milliseconds taken by all map tasks=1045972
		Total megabyte-milliseconds taken by all map tasks=1071075328
	Map-Reduce Framework
		Map input records=100000000
		Map output records=100000000
		Input split bytes=7893
		Spilled Records=0
		Failed Shuffles=0
		Merged Map outputs=0
		GC time elapsed (ms)=31348
		CPU time spent (ms)=1109570
		Physical memory (bytes) snapshot=44309745664
		Virtual memory (bytes) snapshot=243148140544
		Total committed heap usage (bytes)=76469764096
		Peak Map Physical memory (bytes)=492118016
		Peak Map Virtual memory (bytes)=2656796672
	org.apache.hadoop.examples.terasort.TeraGen$Counters
		CHECKSUM=214760662691937609
	File Input Format Counters
		Bytes Read=0
	File Output Format Counters
		Bytes Written=10000000000
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">real	1m21.629s
user	0m10.058s
sys	0m0.693s
</code></pre></div><p>Typical mapper output:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">Closing file system instance: 1392432801
   write.call: 2174978
   write.allTime: 4039
   hsync.call: 1
   hsync.allTime: 79
   hflush.call: 0
   hflush.allTime: 0
   close.call: 4
   close.allTime: 49
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">csm_metrics_write_chunk_num_ops = 2401
om_metrics_num_create_file = 104
</code></pre></div><h3 id="memdisk--2-mappers--freon">memdisk + 2 mappers + freon</h3>
<p>For this a one thread freon process has been started in the background:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">ozone freon  ockg -n1000000 -t1
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">real	4m11.554s
user	0m11.139s
sys	0m0.848s
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">Closing file system instance: 306367949
   write.call: 100001066
   write.allTime: 120016
   hsync.call: 1
   hsync.allTime: 3
   hflush.call: 0
   hflush.allTime: 0
   close.call: 4
   close.allTime: 52
</code></pre></div><h2 id="hardware-physical-machines-gru8">Hardware (physical machines, gru8)</h2>
<p>VENDOR
Manufacturer: Dell Inc.
Product Name: PowerEdge R430
MEMORY
Size: 32 GB
Size: 32 GB
Size: 32 GB
Size: 32 GB
CPUs
Version: Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz
Max Speed: 4000 MHz
Core Enabled: 10
Thread Count: 20
Version: Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz
Max Speed: 4000 MHz
Core Enabled: 10
Thread Count: 20
DISKS
NAME     SIZE TYPE FSTYPE MOUNTPOINT VENDOR   MODEL
sda      1.8T disk                   ATA      ST2000NM0018-2F3
├─sda1 745.2G part xfs    /
├─sda2    10G part swap   [SWAP]
└─sda3   1.1T part xfs    /var
sdb      1.8T disk                   ATA      ST2000NM0018-2F3
└─sdb1   1.8T part xfs    /data/1
sdc      1.8T disk                   ATA      ST2000NM0018-2F3
└─sdc1   1.8T part xfs    /data/2
sdd      1.8T disk                   ATA      ST2000NM0018-2F3
└─sdd1   1.8T part xfs    /data/3</p>

</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/ozone-notes/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
